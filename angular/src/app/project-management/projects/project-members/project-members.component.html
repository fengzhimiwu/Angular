<div class="row clearfix" [@routerTransition]>
  <app-sub-toolbar (searchStart)="searchControl.setValue($event)" searchTip="搜索名字或角色" [isSearching]="isTableLoading">
    <div>项目人员列表 <i class="fa fa-spin fa-spinner" *ngIf="isTableLoading"></i></div>
    <div>
      <button mat-icon-button color="default" appToolbarSearch>
        <mat-icon aria-label="搜索" matTooltip="搜索名字或角色">search</mat-icon>
      </button>
      <button mat-icon-button color="default" (click)="refresh();">
        <mat-icon aria-label="刷新" matTooltip="刷新">refresh</mat-icon>
      </button>
    </div>
  </app-sub-toolbar>
    <mat-card>
    <div class="row clearfix">
      <div class="col-sm-6">
          <app-project-autocomplete (onOptionSelected)="project=$event;stateChanger.next('projectMember')"></app-project-autocomplete>
      </div>
    </div>
    </mat-card>
  <div class="table-responsive">
    <table class="table table-hover clear-margin">
      <thead>
      <tr>
        <th>{{l('姓名')}}</th>
        <th>{{l('电话')}}</th>
        <th>{{l('角色')}}</th>
        <th>{{l('所属项目')}}</th>
        <th>{{l('所属租户')}}</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let projectMember of projectMembers?.items | paginate: { id: 'server', itemsPerPage: pageSize, currentPage: pageNumber, totalItems: totalItems }">
        <td>{{projectMember.user.name}}</td>
        <td>{{projectMember.user.mobileNumber}}</td>
        <td>{{projectMember.user.roleNames.toString()}}</td>
        <td>
          <mat-checkbox [checked]="projectMember.project" #checkbox
                        (change)="addMember($event.checked, checkbox, projectMember)"></mat-checkbox>
          <span *ngIf="projectMember.project"> {{projectMember.project.name}}</span>
          <span *ngIf="!projectMember.project"> 未加入项目</span>
        </td>
        <td>{{projectMember.tenant.name}}</td>
      </tr>
      </tbody>
    </table>

    <div class="sys-ngx-pagination" *ngIf="totalItems > pageSize">
      <pagination-controls (pageChange)="showPaging(projectMembers, $event)" id="server" nextLabel="下一页" previousLabel="上一页"></pagination-controls>
    </div>
  </div>
</div>

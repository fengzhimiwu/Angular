<div class="row" [@routerTransition]>
  <app-sub-toolbar>
    <h4><i class="material-icons arrow-back" matRipple routerLink="../"></i>编辑
      <ng-container *ngIf="taskItem">{{taskItem.name}}</ng-container>表格
    </h4>
    <div>
      <button mat-icon-button (click)="save()"><mat-icon>check</mat-icon></button>
    </div>
  </app-sub-toolbar>
  <div class="form-container">
    <div *ngIf="!taskItem">
      <mat-spinner style="margin: auto"></mat-spinner>
    </div>
    <!--左侧-->
    <div class="drag-group-container">
      <div class="drag-container-left">
        <!--透明的用于拖拽-->
        <div cdkDropList [cdkDropListData]="inputControls" [cdkDropListConnectedTo]="[formBox]" class="drag-list"
             style="position:relative;z-index:1;opacity:0">
          <div cdkDrag [cdkDragData]="item" class="drag-box" *ngFor="let item of inputControls" [ngSwitch]="item.type">
            <ng-container *ngSwitchCase="TaskInputControlType.checkbox"><mat-icon>check_box</mat-icon>勾选框</ng-container>
            <ng-container *ngSwitchCase="TaskInputControlType.label"><mat-icon>text_fields</mat-icon>文字信息</ng-container>
            <ng-container *ngSwitchCase="TaskInputControlType.number"><mat-icon>looks_one</mat-icon>数值</ng-container>
            <ng-container *ngSwitchCase="TaskInputControlType.selection"><mat-icon>tune</mat-icon>搜索/选择</ng-container>
            <ng-container *ngSwitchCase="TaskInputControlType.picture"><mat-icon>photo</mat-icon>图片</ng-container>
          </div>
        </div>
        <!--用于固定的背景-->
        <div cdkDropList cdkDropListDisabled class="drag-list" style="position: absolute;top:0;">
          <div cdkDrag [cdkDragData]="item" class="drag-box" *ngFor="let item of inputControls" [ngSwitch]="item.type">
            <ng-container *ngSwitchCase="TaskInputControlType.checkbox"><mat-icon>check_box</mat-icon>勾选框</ng-container>
            <ng-container *ngSwitchCase="TaskInputControlType.label"><mat-icon>text_fields</mat-icon>文字信息</ng-container>
            <ng-container *ngSwitchCase="TaskInputControlType.number"><mat-icon>looks_one</mat-icon>数值</ng-container>
            <ng-container *ngSwitchCase="TaskInputControlType.selection"><mat-icon>tune</mat-icon>搜索/选择</ng-container>
            <ng-container *ngSwitchCase="TaskInputControlType.picture"><mat-icon>photo</mat-icon>图片</ng-container>
          </div>
        </div>
      </div>
      <!--右侧-->
      <div class="drag-container">
        <div cdkDropList #formBox="cdkDropList" [cdkDropListData]="formItems" class="drag-list"
             (cdkDropListDropped)="drop($event)">

          <div class="drag-box" *ngFor="let item of formItems" cdkDrag [ngSwitch]="item.type">
            <!--勾选框-->
            <div class="col-xs-12" *ngSwitchCase="TaskInputControlType.checkbox">
              <mat-checkbox name="valueName" (mousedown)="$event.stopPropagation();">
                {{item.name}}</mat-checkbox>
              <small>{{item.hint?'提示: '+item.hint:''}}</small>
              <span>
                <button mat-icon-button type="button" (click)="openDialog(item)">
                  <mat-icon class="custom-icon-button">edit</mat-icon>
                </button>
                <button mat-icon-button type="button" (click)="removeItem(item, $event)">
                  <mat-icon class="custom-icon-button">delete</mat-icon>
                </button>
              </span>
            </div>
            <!--期望数值-->
            <div class="col-xs-4" *ngSwitchCase="TaskInputControlType.number">
              <mat-form-field appearance="standard" style="width: 100%">
                <mat-label>测量误差</mat-label>
                <input matInput placeholder="测量误差" [(ngModel)]="item.allowedError" name="allowedError" readonly>
              </mat-form-field>
            </div>
            <div class="col-xs-8" *ngSwitchCase="TaskInputControlType.number">
              <mat-form-field appearance="standard">
                <mat-label>{{item.name}}(数据量: {{item.expectedValNum?item.expectedValNum:'无限制'}})</mat-label>
                <input matInput placeholder="请输入{{item.name}}" type="number" name="valueName"
                       (mousedown)="$event.stopPropagation();">
                <mat-hint align="start">{{item.hint}}</mat-hint>
              </mat-form-field>
              <span>
                <button mat-icon-button type="button" (click)="openDialog(item)">
                  <mat-icon class="custom-icon-button">edit</mat-icon>
                </button>
                <button mat-icon-button type="button" (click)="removeItem(item, $event)">
                  <mat-icon class="custom-icon-button">delete</mat-icon>
                </button>
              </span>
            </div>
            <!--文字-->
            <div class="col-xs-12" *ngSwitchCase="TaskInputControlType.label">
              <mat-form-field appearance="standard">
                <mat-label>{{item.name}}</mat-label>
                <input matInput placeholder="请输入{{item.name}}" name="valueName"
                       (mousedown)="$event.stopPropagation();">
                <mat-hint align="start">{{item.hint}}</mat-hint>
              </mat-form-field>
              <span>
                <button mat-icon-button type="button" (click)="openDialog(item)">
                  <mat-icon class="custom-icon-button">edit</mat-icon>
                </button>
                <button mat-icon-button type="button" (click)="removeItem(item, $event)">
                  <mat-icon class="custom-icon-button">delete</mat-icon>
                </button>
              </span>
            </div>
            <!--搜索选择器-->
            <div class="col-xs-12" *ngSwitchCase="TaskInputControlType.selection">
              <mat-form-field appearance="standard">
                <mat-label>{{item.name}}</mat-label>
                <input matInput placeholder="请输入{{item.name}}" name="valueName" [matAutocomplete]="auto" (mousedown)="$event.stopPropagation();">
                <mat-hint align="start">{{item.hint}}</mat-hint>
                <mat-autocomplete #auto="matAutocomplete">
                  <mat-option>这里是补全选项1</mat-option>
                  <mat-option>这里是补全选项2</mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <span>
                <button mat-icon-button type="button" (click)="openDialog(item)">
                  <mat-icon class="custom-icon-button">edit</mat-icon>
                </button>
                <button mat-icon-button type="button" (click)="removeItem(item, $event)">
                  <mat-icon class="custom-icon-button">delete</mat-icon>
                </button>
              </span>
            </div>
            <!--图片上传-->
            <div class="col-xs-12" *ngSwitchCase="TaskInputControlType.picture">
              <input placeholder="{{item.name}}" name="valueName" type="file"
                     (mousedown)="$event.stopPropagation();" style="display: none" readonly>
              <button mat-stroked-button matTooltip="添加图片" type="button">
                <mat-icon>add_photo_alternate</mat-icon> 添加图片
              </button>
              <span>还未添加文件</span>
              <small>{{item.hint}}</small>
              <span>
                <button mat-icon-button type="button" (click)="openDialog(item)">
                  <mat-icon class="custom-icon-button">edit</mat-icon>
                </button>
                <button mat-icon-button type="button" (click)="removeItem(item, $event)">
                  <mat-icon class="custom-icon-button">delete</mat-icon>
                </button>
              </span>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

<!--<app-button-group>
    <button mat-fab color="primary" type="button">
      <mat-icon>check</mat-icon>
    </button>
  </app-button-group>-->
</div>
